use diagnostics;
use strict;
use warnings;
use File::Basename qw(dirname);
use Test::More tests => 2;

BEGIN {
    use_ok('Digest::SHA')
};

BEGIN {
    my $file = dirname($0) . "/bigfile.tmp";
    open INFILE, "> $file";

    for (1..536870912) {
      print INFILE 'a';  # 2^29 repetitions of 'a'
    }

    close INFILE;

    open INFILE, $file;
    my $sha2obj = new Digest::SHA 256;
    $sha2obj->addfile(*INFILE);
    my $digest = $sha2obj->hexdigest();
    is("b9045a713caed5dff3d3b783e98d1ce5778d8bc331ee4119d707072312af06a7",
        $digest);

    close INFILE;
    unlink $file;
};

